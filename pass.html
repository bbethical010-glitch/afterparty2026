<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Encore After Party ¬∑ Digital Pass</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Montserrat', sans-serif;
  background: url("https://www.thegrandarc.com/images/grand-banner.jpg") center/cover no-repeat fixed;
}
.overlay {
  background: linear-gradient(180deg, rgba(10,0,35,0.9), rgba(0,0,0,0.95));
  min-height: 100vh;
}
h1,h2,h3 { font-family: 'Orbitron', sans-serif; }
.glass {
  background: rgba(20,20,40,0.75);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255,255,255,0.12);
}
</style>
</head>

<body>

<!-- PASSWORD GATE -->
<div id="passwordGate" class="overlay flex items-center justify-center">
  <div class="glass p-6 rounded-xl text-center w-80">
    <img src="cropped-fav.png" class="w-20 mx-auto mb-4">
    <h2 class="text-white mb-4">Enter Access Code</h2>
    <input id="pw" type="password" placeholder="ENCORE2026"
      class="w-full p-3 rounded bg-black text-white mb-4 text-center">
    <button onclick="unlock()" class="w-full bg-pink-500 text-black font-bold py-2 rounded">
      Unlock Pass
    </button>
  </div>
</div>

<!-- APP -->
<div id="app" class="overlay hidden flex flex-col items-center px-4 py-8">

<img src="cropped-fav.png" class="w-24 mb-3">

<h1 class="text-white text-4xl mb-1">Encore After Party</h1>
<p class="text-cyan-300 mb-6">Class of 2025‚Äì26 ¬∑ Invite Only</p>

<!-- COUNTDOWN -->
<div class="glass max-w-md w-full p-4 rounded-xl text-center mb-6">
  <p class="text-gray-400 text-sm">Event Countdown</p>
  <p id="countdown" class="text-white text-xl font-bold"></p>
</div>

<!-- ID INPUT -->
<div class="glass max-w-md w-full p-6 rounded-2xl mb-6">
  <p class="text-gray-400 text-sm mb-3">Unique Pass ID</p>
  <input id="entryId" placeholder="JAI-0XX"
    class="w-full p-3 text-center text-lg uppercase rounded bg-black text-white mb-4">
  <button id="checkBtn"
    class="w-full bg-gradient-to-r from-pink-500 to-cyan-400 text-black font-bold py-3 rounded">
    ACTIVATE PASS
  </button>
</div>

<!-- RESULT -->
<div id="resultCard" class="glass max-w-md w-full p-6 rounded-2xl hidden text-center">
  <h3 id="resTitle" class="text-2xl mb-2"></h3>
  <p id="resName" class="text-cyan-300 font-semibold"></p>
  <p id="resId" class="text-cyan-300 font-semibold mb-2"></p>
  <p id="resStatus" class="text-gray-200 mb-4"></p>


  <button id="pdfBtn"
    class="bg-green-400 text-black font-bold px-6 py-3 rounded hidden">
    Download Digital Pass
  </button>
</div>

<!-- INFO -->
<div class="glass max-w-md w-full p-6 rounded-2xl mt-6 text-center text-sm text-gray-300">
  <p>üìÖ 1 February 2026 ¬∑ 5:00 PM</p>
  <p>üìç Saras Elysium, The Grand Arc Hotel</p>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, getDoc } from
"https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBoMIeT_axIVSyyhBC8PRzcO9z0bhIIyXA",
  authDomain: "encore-entry-system.firebaseapp.com",
  projectId: "encore-entry-system"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const btn = document.getElementById("checkBtn");
const card = document.getElementById("resultCard");
const pdfBtn = document.getElementById("pdfBtn");

let currentName = "", currentId = "";

btn.onclick = async () => {
  const id = entryId.value.trim().toUpperCase();
  if (!id) return;

  const ref = doc(db, "guest_list", id);
  const snap = await getDoc(ref);

  card.classList.remove("hidden");
  pdfBtn.classList.add("hidden");

  if (!snap.exists()) {
    show("‚ùå Invalid Pass", "", "", "ID not found", false);
    return;
  }

  const d = snap.data();
  currentName = d.name;
  currentId = id;

  document.getElementById("resName").innerText = d.name;
  document.getElementById("resId").innerText = id;

  if (d.checkedIn) {
    show("üö´ Already Used", "", "", "This pass has been used", false);
  } else if (!d.paid) {
    show("üí∞ Payment Pending", "", "", "Please contact organizer", false);
  } else {
    show("üéâ Pass Active", "", "", "Show this at entry", true);
    confetti();
    pdfBtn.classList.remove("hidden");
  }
};

function show(title, n, i, status, ok) {
  resTitle.innerText = title;
  resStatus.innerText = status;
  resTitle.className = ok ? "text-green-400 text-2xl" : "text-red-400 text-2xl";
}

pdfBtn.onclick = () => {
  const { jsPDF } = window.jspdf;

  // Landscape A4
  const doc = new jsPDF("landscape", "mm", "a4");

  // COLORS
  const BLACK = "#000000";
  const YELLOW = "#FFC65A";
  const PINK = "#FF2EA6";
  const CYAN = "#2EE8FF";
  const WHITE = "#FFFFFF";

  // BACKGROUND
  doc.setFillColor(BLACK);
  doc.rect(0, 0, 297, 210, "F");

  // HEADER BLOCK
  doc.setFillColor(YELLOW);
  doc.rect(10, 10, 277, 40, "F");

  // LOGO (adjust path if needed)
  const logo = document.querySelector("img")?.src;
  if (logo) doc.addImage(logo, "PNG", 15, 15, 30, 30);

  // TITLE
  doc.setFont("helvetica", "bold");
  doc.setTextColor(BLACK);
  doc.setFontSize(28);
  doc.text("ENCORE AFTER PARTY", 55, 30);

  doc.setFontSize(14);
  doc.text("Class of 2025‚Äì26", 55, 40);

  // DATE & TIME BLOCK
  doc.setFillColor(CYAN);
  doc.rect(10, 60, 130, 40, "F");

  doc.setTextColor(BLACK);
  doc.setFontSize(22);
  doc.text("01.02.2026", 15, 80);
  doc.text("05:00 PM", 15, 95);

  // VENUE BLOCK
  doc.setFillColor(PINK);
  doc.rect(150, 60, 137, 40, "F");

  doc.setTextColor(WHITE);
  doc.setFontSize(16);
  doc.text("THE GRAND ARC HOTEL", 155, 80);
  doc.text("& CONVENTION CENTRE", 155, 92);

  // NAME / ID STRIP
  doc.setFillColor("#111111");
  doc.rect(10, 110, 277, 30, "F");

  doc.setTextColor(WHITE);
  doc.setFontSize(18);
  doc.text(`NAME: ${resName.innerText.replace("Name: ", "")}`, 20, 130);
  doc.text(`ID: ${resId.innerText.replace("ID: ", "")}`, 200, 130);

  // ENTRY INFO
  doc.setFontSize(14);
  doc.setTextColor(CYAN);
  doc.text("SCAN AT THE ENTRY GATE", 20, 160);

  // QR PLACEHOLDER
  doc.setDrawColor(WHITE);
  doc.rect(230, 145, 40, 40);

  doc.setFontSize(10);
  doc.text("ENTRY QR", 240, 190);

  // FOOTER QUOTE
  doc.setFontSize(12);
  doc.setTextColor("#AAAAAA");
  doc.text(
    "Invite-Only ¬∑ One-Time Entry ¬∑ Party Hard, Party Smart",
    148,
    200,
    { align: "center" }
  );

  doc.save("Encore_Digital_Pass.pdf");
};

</script>

<script>
const PASSWORD = "ENCORE2026";
function unlock() {
  if (pw.value === PASSWORD) {
    passwordGate.classList.add("hidden");
    app.classList.remove("hidden");
  } else alert("Wrong access code");
}

// COUNTDOWN
const eventTime = new Date("2026-02-01T17:00:00").getTime();
setInterval(() => {
  const now = new Date().getTime();
  const diff = eventTime - now;
  if (diff < 0) return countdown.innerText = "Now Admitting Guests";
  const d = Math.floor(diff / (1000*60*60*24));
  const h = Math.floor((diff / (1000*60*60)) % 24);
  const m = Math.floor((diff / (1000*60)) % 60);
  countdown.innerText = `${d}d ${h}h ${m}m`;
}, 1000);
</script>

</body>
</html>
